<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="å‹¤æ€ ç®¡ç†">
  <title>å‹¤æ€ ç®¡ç†ã‚¢ãƒ—ãƒª</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
      font-family: "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
      background-color: #0f172a;
      color: #f1f5f9;
    }
    #app {
      height: 100%;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    input, select, textarea, button {
      font-family: inherit;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #60a5fa !important;
    }
    
    /* ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ */
    .login-container {
      padding: 40px 20px;
      max-width: 500px;
      margin: 0 auto;
    }
    .logo-section {
      text-align: center;
      margin-bottom: 40px;
    }
    .logo {
      font-size: 64px;
      margin-bottom: 16px;
    }
    .app-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #60a5fa, #34d399);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .app-subtitle {
      font-size: 14px;
      color: #94a3b8;
    }
    .input-group {
      margin-bottom: 20px;
    }
    .input-label {
      display: block;
      font-size: 14px;
      color: #94a3b8;
      margin-bottom: 8px;
    }
    .login-input {
      width: 100%;
      padding: 18px 16px;
      background-color: #1e293b;
      border: 2px solid #475569;
      border-radius: 12px;
      color: #f1f5f9;
      font-size: 18px;
    }
    .login-error {
      color: #ef4444;
      font-size: 14px;
      text-align: center;
      margin-bottom: 16px;
      padding: 12px;
      background-color: rgba(239, 68, 68, 0.1);
      border-radius: 8px;
      display: none;
    }
    .login-error.show {
      display: block;
    }
    .login-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      border: none;
      border-radius: 14px;
      color: white;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 16px;
    }
    .login-hint {
      font-size: 12px;
      color: #64748b;
      text-align: center;
    }
    
    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background-color: #1e293b;
      border-bottom: 1px solid #334155;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .menu-btn {
      background: none;
      border: 1px solid #475569;
      color: #94a3b8;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }
    .back-btn {
      background: none;
      border: none;
      color: #60a5fa;
      padding: 8px 0;
      cursor: pointer;
      font-size: 16px;
    }
    .header-title {
      font-size: 18px;
      font-weight: 600;
    }
    .date-text {
      font-size: 14px;
      color: #94a3b8;
    }
    
    /* ãƒ›ãƒ¼ãƒ ç”»é¢ */
    .home-content {
      padding: 30px 20px;
      max-width: 500px;
      margin: 0 auto;
    }
    .greeting {
      text-align: center;
      margin-bottom: 20px;
    }
    .greeting-text {
      font-size: 16px;
      color: #94a3b8;
      margin-bottom: 4px;
    }
    .user-name {
      font-size: 24px;
      font-weight: 700;
    }
    .clock-display {
      text-align: center;
      font-size: 48px;
      font-weight: 300;
      font-family: "SF Mono", "Fira Code", monospace;
      color: #60a5fa;
      margin-bottom: 30px;
      letter-spacing: 2px;
    }
    .button-container {
      display: flex;
      gap: 16px;
      margin-bottom: 30px;
    }
    .main-btn {
      flex: 1;
      padding: 30px 20px;
      border-radius: 20px;
      border: none;
      color: white;
      font-size: 20px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .main-btn:disabled {
      opacity: 0.5;
    }
    .clock-in-btn {
      background: linear-gradient(135deg, #f59e0b, #ef4444);
    }
    .clock-out-btn {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    }
    .btn-icon {
      font-size: 32px;
    }
    .status-card {
      background-color: #1e293b;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .status-title {
      font-size: 14px;
      color: #94a3b8;
      margin-bottom: 12px;
    }
    .status-text {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .status-detail {
      font-size: 14px;
      color: #94a3b8;
      margin-bottom: 4px;
    }
    .history-btn {
      width: 100%;
      padding: 16px;
      background-color: #334155;
      border: none;
      border-radius: 12px;
      color: #f1f5f9;
      font-size: 16px;
      cursor: pointer;
    }
    
    /* ãƒ•ã‚©ãƒ¼ãƒ ç”»é¢ */
    .form-content {
      padding: 20px;
      max-width: 500px;
      margin: 0 auto;
    }
    .info-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #334155;
    }
    .info-label {
      color: #94a3b8;
    }
    .info-value {
      font-weight: 500;
    }
    .divider {
      height: 1px;
      background-color: #334155;
      margin: 20px 0;
    }
    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    .form-select {
      width: 100%;
      padding: 16px;
      background-color: #1e293b;
      border: 2px solid #475569;
      border-radius: 12px;
      color: #f1f5f9;
      font-size: 16px;
      margin-bottom: 12px;
    }
    .form-input {
      width: 100%;
      padding: 16px;
      background-color: #1e293b;
      border: 2px solid #475569;
      border-radius: 12px;
      color: #f1f5f9;
      font-size: 16px;
      margin-bottom: 12px;
    }
    .form-textarea {
      width: 100%;
      padding: 16px;
      background-color: #1e293b;
      border: 2px solid #475569;
      border-radius: 12px;
      color: #f1f5f9;
      font-size: 16px;
      min-height: 100px;
      resize: vertical;
      margin-bottom: 12px;
    }
    .gps-section {
      background-color: #1e293b;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
    }
    .gps-info {
      font-size: 14px;
      color: #94a3b8;
    }
    .gps-loading {
      color: #60a5fa;
    }
    .demo-text {
      color: #f59e0b;
      font-size: 12px;
    }
    .error-text {
      color: #ef4444;
      font-size: 14px;
    }
    .confirm-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #10b981, #059669);
      border: none;
      border-radius: 14px;
      color: white;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
    }
    .confirm-btn:disabled {
      opacity: 0.5;
    }
    
    /* ãƒªã‚¹ãƒˆç”»é¢ */
    .list-content {
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
    }
    .date-input {
      width: 100%;
      padding: 16px;
      background-color: #1e293b;
      border: 2px solid #475569;
      border-radius: 12px;
      color: #f1f5f9;
      font-size: 16px;
      margin-bottom: 16px;
    }
    .date-label {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
    }
    .empty-text {
      text-align: center;
      color: #64748b;
      padding: 40px;
    }
    .record-card {
      background-color: #1e293b;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .record-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .record-date, .record-name {
      font-weight: 600;
    }
    .record-status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: white;
    }
    .record-status.working {
      background-color: #48bb78;
    }
    .record-status.completed {
      background-color: #4299e1;
    }
    .record-site {
      font-size: 14px;
      color: #94a3b8;
      margin-bottom: 4px;
    }
    .record-time {
      font-size: 14px;
      color: #60a5fa;
    }
    .record-memo {
      font-size: 13px;
      color: #94a3b8;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid #334155;
    }
    
    /* ç®¡ç†è€…ç”»é¢ */
    .admin-content {
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
    }
    .admin-date {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 20px;
    }
    .stats-container {
      display: flex;
      gap: 16px;
      margin-bottom: 30px;
    }
    .stat-card {
      flex: 1;
      background-color: #1e293b;
      border-radius: 16px;
      padding: 24px;
      text-align: center;
    }
    .stat-number {
      display: block;
      font-size: 40px;
      font-weight: 700;
      color: #60a5fa;
      margin-bottom: 8px;
    }
    .stat-label {
      font-size: 14px;
      color: #94a3b8;
    }
    .site-card {
      background-color: #1e293b;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .site-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .site-name {
      font-weight: 600;
    }
    .site-count {
      font-size: 14px;
      color: #94a3b8;
    }
    .worker-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .worker-tag {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 13px;
      color: white;
    }
    .worker-tag.working {
      background-color: #48bb78;
    }
    .worker-tag.completed {
      background-color: #718096;
    }
    .menu-section {
      margin-top: 30px;
    }
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    .menu-card {
      background-color: #1e293b;
      border: 1px solid #334155;
      border-radius: 16px;
      padding: 24px 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      color: #f1f5f9;
      font-size: 14px;
      font-weight: 500;
    }
    .menu-icon {
      font-size: 28px;
    }
    
    /* ãƒã‚¹ã‚¿ç”»é¢ */
    .add-form {
      background-color: #1e293b;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
    }
    .form-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #f1f5f9;
    }
    .add-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #10b981, #059669);
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }
    .master-card {
      background-color: #1e293b;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .master-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .master-name {
      font-weight: 600;
      font-size: 16px;
      display: flex;
      align-items: center;
    }
    .master-role {
      font-size: 13px;
      color: #94a3b8;
      background-color: #334155;
      padding: 4px 10px;
      border-radius: 8px;
    }
    .master-detail {
      font-size: 14px;
      color: #94a3b8;
      margin-bottom: 12px;
    }
    .toggle-btn {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    .toggle-btn.active {
      background-color: #48bb78;
    }
    .toggle-btn.inactive {
      background-color: #e53e3e;
    }
    .employee-id-badge {
      background-color: #3b82f6;
      color: white;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 12px;
      margin-right: 10px;
    }
    .password-section {
      background-color: #0f172a;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
    }
    .password-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .password-label {
      font-size: 13px;
      color: #94a3b8;
    }
    .password-value {
      font-size: 14px;
      font-family: monospace;
      color: #f1f5f9;
    }
    .show-password-btn {
      background-color: #475569;
      border: none;
      border-radius: 6px;
      color: #f1f5f9;
      padding: 4px 10px;
      font-size: 12px;
      cursor: pointer;
    }
    .password-change-row {
      display: flex;
      gap: 8px;
    }
    .password-input {
      flex: 1;
      padding: 10px 12px;
      background-color: #1e293b;
      border: 1px solid #475569;
      border-radius: 8px;
      color: #f1f5f9;
      font-size: 14px;
    }
    .change-password-btn {
      background-color: #f59e0b;
      border: none;
      border-radius: 8px;
      color: white;
      padding: 10px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    
    .site-detail-card {
      background-color: #1e293b;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
    }
    .site-detail-name {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    .site-stats {
      display: flex;
      gap: 20px;
      font-size: 14px;
      color: #94a3b8;
      margin-bottom: 16px;
    }
    .worker-detail-list {
      border-top: 1px solid #334155;
      padding-top: 12px;
    }
    .worker-detail-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #334155;
      font-size: 14px;
    }
    
    .hidden {
      display: none !important;
    }
    
    /* æœ¬æ—¥ã®å‹¤æ€ å±¥æ­´ */
    .today-history {
      background-color: #1e293b;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 20px;
    }
    .today-record {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      padding: 12px 0;
      border-bottom: 1px solid #334155;
    }
    .today-record:last-child {
      border-bottom: none;
    }
    .today-record-num {
      background-color: #3b82f6;
      color: white;
      padding: 2px 8px;
      border-radius: 6px;
      font-size: 12px;
    }
    .today-record-site {
      font-weight: 500;
      flex: 1;
    }
    .today-record-time {
      font-size: 13px;
      color: #94a3b8;
    }
    .today-record-status {
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      color: white;
    }
    .today-record-status.working {
      background-color: #48bb78;
    }
    .today-record-status.completed {
      background-color: #718096;
    }
    .correction-btn {
      background-color: #f59e0b;
      border: none;
      border-radius: 6px;
      color: white;
      padding: 4px 10px;
      font-size: 11px;
      cursor: pointer;
      margin-left: auto;
    }
    
    /* ä¿®æ­£ä¾é ¼ã‚«ãƒ¼ãƒ‰ */
    .correction-card {
      background-color: #1e293b;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      border-left: 4px solid #f59e0b;
    }
    .correction-card.approved {
      border-left-color: #48bb78;
      opacity: 0.7;
    }
    .correction-card.rejected {
      border-left-color: #e53e3e;
      opacity: 0.7;
    }
    .correction-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .correction-employee {
      font-weight: 600;
      font-size: 16px;
    }
    .correction-status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: white;
    }
    .correction-status.pending {
      background-color: #f59e0b;
    }
    .correction-status.approved {
      background-color: #48bb78;
    }
    .correction-status.rejected {
      background-color: #e53e3e;
    }
    .correction-date {
      font-size: 14px;
      color: #60a5fa;
      margin-bottom: 4px;
    }
    .correction-detail {
      font-size: 13px;
      color: #94a3b8;
      margin-bottom: 8px;
    }
    .correction-reason {
      font-size: 14px;
      color: #f1f5f9;
      background-color: #0f172a;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    .correction-time {
      font-size: 12px;
      color: #64748b;
      margin-bottom: 12px;
    }
    .correction-actions {
      display: flex;
      gap: 10px;
    }
    .approve-btn {
      flex: 1;
      padding: 12px;
      background-color: #48bb78;
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }
    .reject-btn {
      flex: 1;
      padding: 12px;
      background-color: #e53e3e;
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }
    
    /* ç®¡ç†è€…ç”»é¢ã®ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º */
    .stat-card.alert {
      background-color: #7c2d12;
    }
    .menu-card.has-alert {
      background-color: #7c2d12;
      border-color: #f59e0b;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
    const Storage = {
      get: function(key, defaultValue) {
        try {
          const saved = localStorage.getItem('kintai_' + key);
          return saved ? JSON.parse(saved) : defaultValue;
        } catch(e) {
          return defaultValue;
        }
      },
      set: function(key, value) {
        try {
          localStorage.setItem('kintai_' + key, JSON.stringify(value));
        } catch(e) {}
      }
    };

    // ã‚¢ãƒ—ãƒªçŠ¶æ…‹
    const App = {
      currentUser: null,
      currentView: 'login',
      employees: Storage.get('employees', [
        { id: '1', name: 'ç”°ä¸­ å¤ªéƒ', role: 'worker', dailyRate: 15000, isActive: true, password: '1234' },
        { id: '2', name: 'ä½è—¤ èŠ±å­', role: 'worker', dailyRate: 14000, isActive: true, password: '1234' },
        { id: '3', name: 'éˆ´æœ¨ ä¸€éƒ', role: 'worker', dailyRate: 15000, isActive: true, password: '1234' },
        { id: '4', name: 'é«˜æ©‹ ç¾å’²', role: 'manager', dailyRate: 16000, isActive: true, password: '1234' },
        { id: '5', name: 'å±±ç”° å¥å¤ª', role: 'worker', dailyRate: 14000, isActive: true, password: '1234' },
        { id: 'admin', name: 'ä»ã•ã‚“', role: 'admin', dailyRate: 0, isActive: true, password: 'admin' }
      ]),
      jobSites: Storage.get('jobsites', [
        { id: '1', name: 'ã‚¹ãƒ¼ãƒ‘ãƒ¼ä¸‰å’Œç”ºç”°åº—', address: 'æ±äº¬éƒ½ç”ºç”°å¸‚', isActive: true },
        { id: '2', name: 'ãƒ‘ãƒ¼ã‚¯ã‚·ãƒ†ã‚£æ¨ªæµœ', address: 'ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚', isActive: true },
        { id: '3', name: 'ã‚¢ãƒˆãƒªã‚¨ã†ã‹ã„', address: 'ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚', isActive: true }
      ]),
      records: Storage.get('records', []),
      corrections: Storage.get('corrections', []),
      gpsLocation: null,
      selectedDate: new Date().toISOString().split('T')[0],

      save: function() {
        Storage.set('employees', this.employees);
        Storage.set('jobsites', this.jobSites);
        Storage.set('records', this.records);
        Storage.set('corrections', this.corrections);
      },

      getToday: function() {
        return new Date().toISOString().split('T')[0];
      },

      getTodayRecord: function() {
        if (!this.currentUser) return null;
        // ä»Šæ—¥ã®ã€Œå‹¤å‹™ä¸­ã€ã®è¨˜éŒ²ã‚’å–å¾—ï¼ˆè¤‡æ•°å›å‡ºé€€å‹¤å¯¾å¿œï¼‰
        return this.records.find(r => 
          r.employeeId === this.currentUser.id && 
          r.workDate === this.getToday() && 
          r.status === 'working'
        );
      },

      getTodayRecords: function() {
        if (!this.currentUser) return [];
        // ä»Šæ—¥ã®å…¨è¨˜éŒ²ã‚’å–å¾—
        return this.records.filter(r => 
          r.employeeId === this.currentUser.id && 
          r.workDate === this.getToday()
        );
      },

      formatTime: function(isoString) {
        if (!isoString) return '--:--';
        return new Date(isoString).toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
      },

      formatDate: function(dateStr) {
        const date = new Date(dateStr);
        const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
        return (date.getMonth() + 1) + '/' + date.getDate() + 'ï¼ˆ' + days[date.getDay()] + 'ï¼‰';
      },

      getGreeting: function() {
        const hour = new Date().getHours();
        if (hour < 12) return 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™';
        if (hour < 18) return 'ã“ã‚“ã«ã¡ã¯';
        return 'ãŠç–²ã‚Œã•ã¾ã§ã™';
      },

      getTodayBySite: function() {
        const today = this.getToday();
        const todayRecords = this.records.filter(r => r.workDate === today);
        const bySite = {};
        todayRecords.forEach(r => {
          if (!bySite[r.jobSiteName]) {
            bySite[r.jobSiteName] = { total: 0, working: 0, workers: [] };
          }
          bySite[r.jobSiteName].total++;
          if (r.status === 'working') bySite[r.jobSiteName].working++;
          bySite[r.jobSiteName].workers.push({
            name: r.employeeName,
            status: r.status,
            clockIn: r.clockInTime,
            clockOut: r.clockOutTime
          });
        });
        return bySite;
      },

      getGPS: function(callback) {
        this.gpsLocation = null;
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function(position) {
              App.gpsLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
                accuracy: position.coords.accuracy
              };
              if (callback) callback();
            },
            function(error) {
              App.gpsLocation = { lat: 35.4437, lng: 139.6380, accuracy: 50, isDemo: true };
              if (callback) callback();
            }
          );
        } else {
          this.gpsLocation = { lat: 35.4437, lng: 139.6380, accuracy: 50, isDemo: true };
          if (callback) callback();
        }
      }
    };

    // ç”»é¢æç”»
    const Views = {
      render: function(view) {
        App.currentView = view;
        const app = document.getElementById('app');
        app.innerHTML = this[view] ? this[view]() : this.login();
        this.bindEvents(view);
      },

      login: function() {
        return `
          <div class="login-container">
            <div class="logo-section">
              <div class="logo">ğŸ—ï¸</div>
              <h1 class="app-title">å‹¤æ€ ç®¡ç†</h1>
              <p class="app-subtitle">è¶³å ´ä¼šç¤¾å‘ã‘å‹¤æ€ ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
            </div>
            <div>
              <div class="input-group">
                <label class="input-label">å¾“æ¥­å“¡ID</label>
                <input type="text" id="loginId" class="login-input" placeholder="ä¾‹: 1" autocomplete="off" autocapitalize="off" autocorrect="off" inputmode="numeric" pattern="[0-9a-zA-Z]*">
              </div>
              <div class="input-group">
                <label class="input-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" id="loginPassword" class="login-input" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" autocomplete="off" inputmode="latin">
              </div>
              <p id="loginError" class="login-error">IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“</p>
              <button id="loginBtn" class="login-btn">ãƒ­ã‚°ã‚¤ãƒ³</button>
              <p class="login-hint">â€» åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ã€Œ1234ã€ã§ã™ï¼ˆç®¡ç†è€…ã¯ã€Œadminã€ï¼‰</p>
            </div>
          </div>
        `;
      },

      home: function() {
        const workingRecord = App.getTodayRecord();
        const todayRecords = App.getTodayRecords();
        const completedRecords = todayRecords.filter(r => r.status === 'completed');
        const isWorking = !!workingRecord;
        
        let statusHtml = '<p class="status-text">æœªå‡ºå‹¤</p>';
        if (isWorking) {
          statusHtml = `
            <p class="status-text">ğŸŸ¢ å‹¤å‹™ä¸­</p>
            <p class="status-detail">å‡ºå‹¤: ${App.formatTime(workingRecord.clockInTime)}</p>
            <p class="status-detail">ç¾å ´: ${workingRecord.jobSiteName}</p>
          `;
        } else if (completedRecords.length > 0) {
          const lastRecord = completedRecords[completedRecords.length - 1];
          const totalHours = completedRecords.reduce((sum, r) => sum + (r.workHours || 0), 0);
          statusHtml = `
            <p class="status-text">âœ… æœ¬æ—¥ ${completedRecords.length}å› å‹¤å‹™å®Œäº†</p>
            <p class="status-detail">åˆè¨ˆå‹¤å‹™æ™‚é–“: ${totalHours.toFixed(1)}æ™‚é–“</p>
            <p class="status-detail">æœ€çµ‚: ${App.formatTime(lastRecord.clockInTime)} ã€œ ${App.formatTime(lastRecord.clockOutTime)}</p>
            <p class="status-detail">ç¾å ´: ${lastRecord.jobSiteName}</p>
          `;
        }

        // ä»Šæ—¥ã®å‹¤æ€ å±¥æ­´
        let todayHistoryHtml = '';
        if (todayRecords.length > 0) {
          todayHistoryHtml = '<div class="today-history"><p class="section-title">æœ¬æ—¥ã®å‹¤æ€ </p>';
          todayRecords.forEach((r, index) => {
            todayHistoryHtml += `
              <div class="today-record">
                <span class="today-record-num">${index + 1}å›ç›®</span>
                <span class="today-record-site">${r.jobSiteName}</span>
                <span class="today-record-time">${App.formatTime(r.clockInTime)} ã€œ ${App.formatTime(r.clockOutTime)}</span>
                <span class="today-record-status ${r.status}">${r.status === 'working' ? 'å‹¤å‹™ä¸­' : 'å®Œäº†'}</span>
                <button class="correction-btn" data-record="${r.id}">ä¿®æ­£ä¾é ¼</button>
              </div>
            `;
          });
          todayHistoryHtml += '</div>';
        }

        return `
          <div class="header">
            <button id="logoutBtn" class="menu-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            <span class="date-text">${App.formatDate(App.getToday())}</span>
          </div>
          <div class="home-content">
            <div class="greeting">
              <p class="greeting-text">${App.getGreeting()}</p>
              <h2 class="user-name">${App.currentUser.name} ã•ã‚“</h2>
            </div>
            <div id="clock" class="clock-display"></div>
            <div class="button-container">
              <button id="clockInBtn" class="main-btn clock-in-btn" ${isWorking ? 'disabled' : ''}>
                <span class="btn-icon">ğŸŒ…</span>
                <span>å‡º å‹¤</span>
              </button>
              <button id="clockOutBtn" class="main-btn clock-out-btn" ${!isWorking ? 'disabled' : ''}>
                <span class="btn-icon">ğŸŒ†</span>
                <span>é€€ å‹¤</span>
              </button>
            </div>
            <div class="status-card">
              <h3 class="status-title">æœ¬æ—¥ã®çŠ¶æ…‹</h3>
              ${statusHtml}
            </div>
            ${todayHistoryHtml}
            <button id="historyBtn" class="history-btn">ğŸ“‹ å‹¤æ€ å±¥æ­´ã‚’è¦‹ã‚‹</button>
          </div>
        `;
      },

      clockIn: function() {
        let siteOptions = '<option value="">-- ç¾å ´ã‚’é¸æŠ --</option>';
        App.jobSites.filter(s => s.isActive).forEach(site => {
          siteOptions += `<option value="${site.id}">${site.name}</option>`;
        });
        siteOptions += '<option value="custom">ãã®ä»–ï¼ˆæ‰‹å…¥åŠ›ï¼‰</option>';

        let gpsHtml = '<p class="gps-loading">ä½ç½®æƒ…å ±ã‚’å–å¾—ä¸­...</p>';
        if (App.gpsLocation) {
          gpsHtml = `
            <div class="gps-info">
              <p>ç·¯åº¦: ${App.gpsLocation.lat.toFixed(4)}</p>
              <p>çµŒåº¦: ${App.gpsLocation.lng.toFixed(4)}</p>
              <p>ç²¾åº¦: Â±${Math.round(App.gpsLocation.accuracy)}m</p>
              ${App.gpsLocation.isDemo ? '<p class="demo-text">ï¼ˆãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ï¼‰</p>' : ''}
            </div>
          `;
        }

        return `
          <div class="header">
            <button id="backBtn" class="back-btn">â† æˆ»ã‚‹</button>
            <span class="header-title">å‡ºå‹¤æ‰“åˆ»</span>
          </div>
          <div class="form-content">
            <div class="info-row">
              <span class="info-label">å¾“æ¥­å“¡</span>
              <span class="info-value">${App.currentUser.name}</span>
            </div>
            <div class="info-row">
              <span class="info-label">æ—¥æ™‚</span>
              <span class="info-value">${App.formatDate(App.getToday())} ${new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })}</span>
            </div>
            <div class="divider"></div>
            <p class="section-title">ç¾å ´ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
            <select id="jobSiteSelect" class="form-select">${siteOptions}</select>
            <input type="text" id="customJobSite" class="form-input hidden" placeholder="ç¾å ´åã‚’å…¥åŠ›">
            <div class="divider"></div>
            <div class="gps-section">
              <p class="section-title">ğŸ“ ç¾åœ¨åœ°</p>
              <div id="gpsInfo">${gpsHtml}</div>
            </div>
            <button id="confirmClockIn" class="confirm-btn" disabled>å‡ºå‹¤ã‚’ç¢ºå®š</button>
          </div>
        `;
      },

      clockOut: function() {
        const record = App.getTodayRecord();
        let gpsHtml = '<p class="gps-loading">ä½ç½®æƒ…å ±ã‚’å–å¾—ä¸­...</p>';
        if (App.gpsLocation) {
          gpsHtml = `
            <div class="gps-info">
              <p>ç·¯åº¦: ${App.gpsLocation.lat.toFixed(4)}</p>
              <p>çµŒåº¦: ${App.gpsLocation.lng.toFixed(4)}</p>
            </div>
          `;
        }

        return `
          <div class="header">
            <button id="backBtn" class="back-btn">â† æˆ»ã‚‹</button>
            <span class="header-title">é€€å‹¤æ‰“åˆ»</span>
          </div>
          <div class="form-content">
            <div class="info-row">
              <span class="info-label">å¾“æ¥­å“¡</span>
              <span class="info-value">${App.currentUser.name}</span>
            </div>
            <div class="info-row">
              <span class="info-label">ç¾å ´</span>
              <span class="info-value">${record ? record.jobSiteName : ''}</span>
            </div>
            <div class="info-row">
              <span class="info-label">å‡ºå‹¤æ™‚åˆ»</span>
              <span class="info-value">${record ? App.formatTime(record.clockInTime) : ''}</span>
            </div>
            <div class="info-row">
              <span class="info-label">ç¾åœ¨æ™‚åˆ»</span>
              <span class="info-value">${new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' })}</span>
            </div>
            <div class="divider"></div>
            <p class="section-title">ä½œæ¥­å†…å®¹ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</p>
            <textarea id="workMemo" class="form-textarea" placeholder="æœ¬æ—¥ã®ä½œæ¥­å†…å®¹ã‚’å…¥åŠ›"></textarea>
            <div class="gps-section">
              <p class="section-title">ğŸ“ ç¾åœ¨åœ°</p>
              <div id="gpsInfo">${gpsHtml}</div>
            </div>
            <button id="confirmClockOut" class="confirm-btn">é€€å‹¤ã‚’ç¢ºå®š</button>
          </div>
        `;
      },

      history: function() {
        const records = App.records
          .filter(r => r.employeeId === App.currentUser.id)
          .sort((a, b) => new Date(b.workDate) - new Date(a.workDate));
        
        let recordsHtml = '';
        if (records.length === 0) {
          recordsHtml = '<p class="empty-text">å‹¤æ€ è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        } else {
          records.forEach(r => {
            recordsHtml += `
              <div class="record-card">
                <div class="record-header">
                  <span class="record-date">${App.formatDate(r.workDate)}</span>
                  <span class="record-status ${r.status}">${r.status === 'working' ? 'å‹¤å‹™ä¸­' : 'å®Œäº†'}</span>
                </div>
                <p class="record-site">ğŸ—ï¸ ${r.jobSiteName}</p>
                <p class="record-time">${App.formatTime(r.clockInTime)} ã€œ ${App.formatTime(r.clockOutTime)}${r.workHours ? ' ï¼ˆ' + r.workHours.toFixed(1) + 'hï¼‰' : ''}</p>
                ${r.memo ? '<p class="record-memo">ğŸ“ ' + r.memo + '</p>' : ''}
              </div>
            `;
          });
        }

        return `
          <div class="header">
            <button id="backBtn" class="back-btn">â† æˆ»ã‚‹</button>
            <span class="header-title">å‹¤æ€ å±¥æ­´</span>
          </div>
          <div class="list-content">${recordsHtml}</div>
        `;
      },

      admin: function() {
        const bySite = App.getTodayBySite();
        const siteNames = Object.keys(bySite);
        let totalWorkers = 0;
        siteNames.forEach(name => { totalWorkers += bySite[name].total; });

        // æœªå‡¦ç†ã®ä¿®æ­£ä¾é ¼æ•°
        const pendingCorrections = App.corrections.filter(c => c.status === 'pending').length;

        let sitesHtml = '';
        if (siteNames.length === 0) {
          sitesHtml = '<p class="empty-text">æœ¬æ—¥ã®å‡ºå‹¤è€…ã¯ã¾ã ã„ã¾ã›ã‚“</p>';
        } else {
          siteNames.forEach(name => {
            const data = bySite[name];
            let workersHtml = '';
            data.workers.forEach(w => {
              workersHtml += `<span class="worker-tag ${w.status}">${w.name}</span>`;
            });
            sitesHtml += `
              <div class="site-card">
                <div class="site-header">
                  <span class="site-name">ğŸ—ï¸ ${name}</span>
                  <span class="site-count">${data.total}åï¼ˆç¨¼åƒä¸­: ${data.working}åï¼‰</span>
                </div>
                <div class="worker-list">${workersHtml}</div>
              </div>
            `;
          });
        }

        return `
          <div class="header">
            <button id="logoutBtn" class="menu-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            <span class="header-title">ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
          </div>
          <div class="admin-content">
            <p class="admin-date">${App.formatDate(App.getToday())}</p>
            <div class="stats-container">
              <div class="stat-card">
                <span class="stat-number">${totalWorkers}</span>
                <span class="stat-label">æœ¬æ—¥å‡ºå‹¤</span>
              </div>
              <div class="stat-card">
                <span class="stat-number">${siteNames.length}</span>
                <span class="stat-label">ç¾å ´ç¨¼åƒ</span>
              </div>
              <div class="stat-card ${pendingCorrections > 0 ? 'alert' : ''}">
                <span class="stat-number">${pendingCorrections}</span>
                <span class="stat-label">ä¿®æ­£ä¾é ¼</span>
              </div>
            </div>
            <div class="section-header">
              <h3 class="section-title">ç¾å ´åˆ¥çŠ¶æ³</h3>
            </div>
            ${sitesHtml}
            <div class="menu-section">
              <h3 class="section-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
              <div class="menu-grid">
                <button class="menu-card" data-view="dailyList">
                  <span class="menu-icon">ğŸ“…</span>
                  <span>æ—¥åˆ¥å‹¤æ€ ä¸€è¦§</span>
                </button>
                <button class="menu-card" data-view="siteList">
                  <span class="menu-icon">ğŸ—ï¸</span>
                  <span>ç¾å ´åˆ¥ä¸€è¦§</span>
                </button>
                <button class="menu-card" data-view="employeeMaster">
                  <span class="menu-icon">ğŸ‘¤</span>
                  <span>å¾“æ¥­å“¡ãƒã‚¹ã‚¿</span>
                </button>
                <button class="menu-card" data-view="siteMaster">
                  <span class="menu-icon">ğŸ¢</span>
                  <span>ç¾å ´ãƒã‚¹ã‚¿</span>
                </button>
                <button class="menu-card ${pendingCorrections > 0 ? 'has-alert' : ''}" data-view="correctionList">
                  <span class="menu-icon">ğŸ“</span>
                  <span>ä¿®æ­£ä¾é ¼${pendingCorrections > 0 ? 'ï¼ˆ' + pendingCorrections + 'ä»¶ï¼‰' : ''}</span>
                </button>
              </div>
            </div>
          </div>
        `;
      },

      dailyList: function() {
        const records = App.records.filter(r => r.workDate === App.selectedDate);
        let recordsHtml = '';
        if (records.length === 0) {
          recordsHtml = '<p class="empty-text">ã“ã®æ—¥ã®è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        } else {
          records.forEach(r => {
            recordsHtml += `
              <div class="record-card">
                <div class="record-header">
                  <span class="record-name">${r.employeeName}</span>
                  <span class="record-status ${r.status}">${r.status === 'working' ? 'å‹¤å‹™ä¸­' : 'å®Œäº†'}</span>
                </div>
                <p class="record-site">ğŸ—ï¸ ${r.jobSiteName}</p>
                <p class="record-time">${App.formatTime(r.clockInTime)} ã€œ ${App.formatTime(r.clockOutTime)}${r.workHours ? ' ï¼ˆ' + r.workHours.toFixed(1) + 'hï¼‰' : ''}</p>
              </div>
            `;
          });
        }

        return `
          <div class="header">
            <button id="backBtn" class="back-btn">â† æˆ»ã‚‹</button>
            <span class="header-title">æ—¥åˆ¥å‹¤æ€ ä¸€è¦§</span>
          </div>
          <div class="list-content">
            <input type="date" id="dateSelect" class="date-input" value="${App.selectedDate}">
            <p class="date-label">${App.formatDate(App.selectedDate)} ã®å‹¤æ€ </p>
            ${recordsHtml}
          </div>
        `;
      },

      siteList: function() {
        const bySite = App.getTodayBySite();
        const siteNames = Object.keys(bySite);
        
        let sitesHtml = '';
        if (siteNames.length === 0) {
          sitesHtml = '<p class="empty-text">æœ¬æ—¥ã®å‡ºå‹¤è€…ã¯ã¾ã ã„ã¾ã›ã‚“</p>';
        } else {
          siteNames.forEach(name => {
            const data = bySite[name];
            let workersHtml = '';
            data.workers.forEach(w => {
              workersHtml += `
                <div class="worker-detail-row">
                  <span>${w.name}</span>
                  <span>${App.formatTime(w.clockIn)} ã€œ ${App.formatTime(w.clockOut)}</span>
                  <span style="color: ${w.status === 'working' ? '#48bb78' : '#718096'}">${w.status === 'working' ? 'å‹¤å‹™ä¸­' : 'é€€å‹¤æ¸ˆ'}</span>
                </div>
              `;
            });
            sitesHtml += `
              <div class="site-detail-card">
                <h3 class="site-detail-name">ğŸ—ï¸ ${name}</h3>
                <div class="site-stats">
                  <span>å‡ºå‹¤: ${data.total}å</span>
                  <span>ç¾å ´ä¸­: ${data.working}å</span>
                </div>
                <div class="worker-detail-list">${workersHtml}</div>
              </div>
            `;
          });
        }

        return `
          <div class="header">
            <button id="backBtn" class="back-btn">â† æˆ»ã‚‹</button>
            <span class="header-title">ç¾å ´åˆ¥ä¸€è¦§</span>
          </div>
          <div class="list-content">
            <p class="date-label">${App.formatDate(App.getToday())} ã®ç¾å ´åˆ¥çŠ¶æ³</p>
            ${sitesHtml}
          </div>
        `;
      },

      employeeMaster: function() {
        let employeesHtml = '';
        App.employees.filter(e => e.id !== 'admin').forEach(emp => {
          employeesHtml += `
            <div class="master-card" data-id="${emp.id}">
              <div class="master-header">
                <span class="master-name">
                  <span class="employee-id-badge">ID: ${emp.id}</span>
                  ${emp.name}
                </span>
                <span class="master-role">${emp.role === 'manager' ? 'è²¬ä»»è€…' : 'ä½œæ¥­å“¡'}</span>
              </div>
              <p class="master-detail">æ—¥å½“: Â¥${emp.dailyRate.toLocaleString()}</p>
              <div class="password-section">
                <div class="password-row">
                  <span class="password-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</span>
                  <span class="password-value" data-emp="${emp.id}">â€¢â€¢â€¢â€¢</span>
                  <button class="show-password-btn" data-emp="${emp.id}">è¡¨ç¤º</button>
                </div>
                <div class="password-change-row">
                  <input type="text" class="password-input" data-emp="${emp.id}" placeholder="æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
                  <button class="change-password-btn" data-emp="${emp.id}">å¤‰æ›´</button>
                </div>
              </div>
              <button class="toggle-btn ${emp.isActive ? 'active' : 'inactive'}" data-emp="${emp.id}">${emp.isActive ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}</button>
            </div>
          `;
        });

        return `
          <div class="header">
            <button id="backBtn" class="back-btn">â† æˆ»ã‚‹</button>
            <span class="header-title">å¾“æ¥­å“¡ãƒã‚¹ã‚¿</span>
          </div>
          <div class="list-content">
            <div class="add-form">
              <h3 class="form-title">æ–°è¦å¾“æ¥­å“¡ç™»éŒ²</h3>
              <input type="text" id="newEmpName" class="form-input" placeholder="å¾“æ¥­å“¡å">
              <select id="newEmpRole" class="form-select">
                <option value="worker">ä½œæ¥­å“¡</option>
                <option value="manager">è²¬ä»»è€…</option>
              </select>
              <input type="number" id="newEmpRate" class="form-input" placeholder="æ—¥å½“" value="14000">
              <input type="text" id="newEmpPassword" class="form-input" placeholder="åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" value="1234">
              <button id="addEmployeeBtn" class="add-btn">è¿½åŠ </button>
            </div>
            ${employeesHtml}
          </div>
        `;
      },

      siteMaster: function() {
        let sitesHtml = '';
        App.jobSites.forEach(site => {
          sitesHtml += `
            <div class="master-card">
              <div class="master-header">
                <span class="master-name">ğŸ—ï¸ ${site.name}</span>
              </div>
              <p class="master-detail">${site.address || 'ä½æ‰€æœªè¨­å®š'}</p>
              <button class="toggle-btn ${site.isActive ? 'active' : 'inactive'}" data-site="${site.id}">${site.isActive ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}</button>
            </div>
          `;
        });

        return `
          <div class="header">
            <button id="backBtn" class="back-btn">â† æˆ»ã‚‹</button>
            <span class="header-title">ç¾å ´ãƒã‚¹ã‚¿</span>
          </div>
          <div class="list-content">
            <div class="add-form">
              <h3 class="form-title">æ–°è¦ç¾å ´ç™»éŒ²</h3>
              <input type="text" id="newSiteName" class="form-input" placeholder="ç¾å ´å">
              <input type="text" id="newSiteAddress" class="form-input" placeholder="ä½æ‰€">
              <button id="addSiteBtn" class="add-btn">è¿½åŠ </button>
            </div>
            ${sitesHtml}
          </div>
        `;
      },

      correctionList: function() {
        const corrections = App.corrections.sort((a, b) => {
          if (a.status === 'pending' && b.status !== 'pending') return -1;
          if (a.status !== 'pending' && b.status === 'pending') return 1;
          return new Date(b.createdAt) - new Date(a.createdAt);
        });

        let correctionsHtml = '';
        if (corrections.length === 0) {
          correctionsHtml = '<p class="empty-text">ä¿®æ­£ä¾é ¼ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        } else {
          corrections.forEach(c => {
            const record = App.records.find(r => r.id === c.recordId);
            const statusClass = c.status === 'pending' ? 'pending' : (c.status === 'approved' ? 'approved' : 'rejected');
            const statusText = c.status === 'pending' ? 'æœªå‡¦ç†' : (c.status === 'approved' ? 'æ‰¿èªæ¸ˆ' : 'å´ä¸‹');
            
            correctionsHtml += `
              <div class="correction-card ${statusClass}">
                <div class="correction-header">
                  <span class="correction-employee">${c.employeeName}</span>
                  <span class="correction-status ${statusClass}">${statusText}</span>
                </div>
                <p class="correction-date">ğŸ“… ${App.formatDate(c.recordDate)}</p>
                <p class="correction-detail">
                  ç¾å ´: ${record ? record.jobSiteName : 'ä¸æ˜'}<br>
                  è¨˜éŒ²: ${record ? App.formatTime(record.clockInTime) + ' ã€œ ' + App.formatTime(record.clockOutTime) : 'ä¸æ˜'}
                </p>
                <p class="correction-reason">ğŸ“ ${c.reason}</p>
                <p class="correction-time">ä¾é ¼æ—¥æ™‚: ${new Date(c.createdAt).toLocaleString('ja-JP')}</p>
                ${c.status === 'pending' ? `
                  <div class="correction-actions">
                    <button class="approve-btn" data-correction="${c.id}">æ‰¿èªï¼ˆè¨˜éŒ²å‰Šé™¤ï¼‰</button>
                    <button class="reject-btn" data-correction="${c.id}">å´ä¸‹</button>
                  </div>
                ` : ''}
              </div>
            `;
          });
        }

        return `
          <div class="header">
            <button id="backBtn" class="back-btn">â† æˆ»ã‚‹</button>
            <span class="header-title">ä¿®æ­£ä¾é ¼ä¸€è¦§</span>
          </div>
          <div class="list-content">
            ${correctionsHtml}
          </div>
        `;
      },

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒ‰
      bindEvents: function(view) {
        const self = this;

        // å…±é€šã‚¤ãƒ™ãƒ³ãƒˆ
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', function() {
            App.currentUser = null;
            self.render('login');
          });
        }

        const backBtn = document.getElementById('backBtn');
        if (backBtn) {
          backBtn.addEventListener('click', function() {
            if (App.currentUser.role === 'admin') {
              self.render('admin');
            } else {
              self.render('home');
            }
          });
        }

        // æ™‚è¨ˆæ›´æ–°
        if (view === 'home') {
          const clockEl = document.getElementById('clock');
          if (clockEl) {
            function updateClock() {
              clockEl.textContent = new Date().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            }
            updateClock();
            setInterval(updateClock, 1000);
          }
        }

        // ãƒ­ã‚°ã‚¤ãƒ³
        if (view === 'login') {
          const loginBtn = document.getElementById('loginBtn');
          const loginIdInput = document.getElementById('loginId');
          const loginPasswordInput = document.getElementById('loginPassword');
          const loginError = document.getElementById('loginError');

          // åŠè§’å¤‰æ›é–¢æ•°
          function toHalfWidth(str) {
            return str.replace(/[ï¼-ï¼™ï½-ï½šï¼¡-ï¼º]/g, function(s) {
              return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
            }).replace(/[^0-9a-zA-Z]/g, '');
          }

          // IDå…¥åŠ›æ™‚ã«è‡ªå‹•ã§åŠè§’å¤‰æ›
          if (loginIdInput) {
            loginIdInput.addEventListener('input', function() {
              const converted = toHalfWidth(this.value);
              if (this.value !== converted) {
                this.value = converted;
              }
            });
          }

          // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›æ™‚ã«å…¨è§’ã‚’åŠè§’ã«å¤‰æ›
          if (loginPasswordInput) {
            loginPasswordInput.addEventListener('input', function() {
              const original = this.value;
              const converted = original.replace(/[ï¼-ï¼™ï½-ï½šï¼¡-ï¼º]/g, function(s) {
                return String.fromCharCode(s.charCodeAt(0) - 0xFEE0);
              });
              if (original !== converted) {
                this.value = converted;
              }
            });
          }

          if (loginBtn) {
            loginBtn.addEventListener('click', function() {
              const id = toHalfWidth(loginIdInput.value.trim());
              const password = loginPasswordInput.value;
              const emp = App.employees.find(e => (e.id === id) && e.password === password && e.isActive);
              
              if (emp) {
                App.currentUser = emp;
                loginError.classList.remove('show');
                self.render(emp.role === 'admin' ? 'admin' : 'home');
              } else {
                loginError.classList.add('show');
              }
            });
          }

          if (loginPasswordInput) {
            loginPasswordInput.addEventListener('keydown', function(e) {
              if (e.key === 'Enter') {
                loginBtn.click();
              }
            });
          }
        }

        // ãƒ›ãƒ¼ãƒ 
        if (view === 'home') {
          const clockInBtn = document.getElementById('clockInBtn');
          const clockOutBtn = document.getElementById('clockOutBtn');
          const historyBtn = document.getElementById('historyBtn');

          if (clockInBtn) {
            clockInBtn.addEventListener('click', function() {
              if (!this.disabled) {
                App.getGPS(function() { self.render('clockIn'); });
              }
            });
          }
          if (clockOutBtn) {
            clockOutBtn.addEventListener('click', function() {
              if (!this.disabled) {
                App.getGPS(function() { self.render('clockOut'); });
              }
            });
          }
          if (historyBtn) {
            historyBtn.addEventListener('click', function() {
              self.render('history');
            });
          }

          // ä¿®æ­£ä¾é ¼ãƒœã‚¿ãƒ³
          document.querySelectorAll('.correction-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
              const recordId = this.getAttribute('data-record');
              const record = App.records.find(r => r.id === recordId);
              if (!record) return;

              const reason = prompt('ä¿®æ­£ä¾é ¼ã®ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\nä¾‹: å‡ºå‹¤æ™‚é–“ã‚’é–“é•ãˆãŸã€é€€å‹¤ã‚’æŠ¼ã—å¿˜ã‚ŒãŸ ãªã©');
              if (!reason) return;

              App.corrections.push({
                id: Date.now().toString(),
                recordId: recordId,
                recordDate: record.workDate,
                employeeId: App.currentUser.id,
                employeeName: App.currentUser.name,
                reason: reason,
                status: 'pending',
                createdAt: new Date().toISOString()
              });
              App.save();
              alert('ä¿®æ­£ä¾é ¼ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ç®¡ç†è€…ãŒç¢ºèªã—ã¾ã™ã€‚');
              self.render('home');
            });
          });
        }

        // å‡ºå‹¤æ‰“åˆ»
        if (view === 'clockIn') {
          const jobSiteSelect = document.getElementById('jobSiteSelect');
          const customJobSite = document.getElementById('customJobSite');
          const confirmBtn = document.getElementById('confirmClockIn');

          if (jobSiteSelect) {
            jobSiteSelect.addEventListener('change', function() {
              if (this.value === 'custom') {
                customJobSite.classList.remove('hidden');
                confirmBtn.disabled = !customJobSite.value.trim();
              } else {
                customJobSite.classList.add('hidden');
                confirmBtn.disabled = !this.value;
              }
            });
          }

          if (customJobSite) {
            customJobSite.addEventListener('input', function() {
              confirmBtn.disabled = !this.value.trim();
            });
          }

          if (confirmBtn) {
            confirmBtn.addEventListener('click', function() {
              const siteId = jobSiteSelect.value;
              let siteName = '';
              if (siteId === 'custom') {
                siteName = customJobSite.value.trim();
              } else {
                const site = App.jobSites.find(s => s.id === siteId);
                siteName = site ? site.name : '';
              }

              if (!siteName) {
                alert('ç¾å ´ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
              }

              const newRecord = {
                id: Date.now().toString(),
                employeeId: App.currentUser.id,
                employeeName: App.currentUser.name,
                jobSiteId: siteId,
                jobSiteName: siteName,
                workDate: App.getToday(),
                clockInTime: new Date().toISOString(),
                clockOutTime: null,
                clockInLat: App.gpsLocation ? App.gpsLocation.lat : null,
                clockInLng: App.gpsLocation ? App.gpsLocation.lng : null,
                memo: '',
                status: 'working'
              };

              App.records.push(newRecord);
              App.save();
              alert('å‡ºå‹¤ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼');
              self.render('home');
            });
          }
        }

        // é€€å‹¤æ‰“åˆ»
        if (view === 'clockOut') {
          const confirmBtn = document.getElementById('confirmClockOut');
          const workMemo = document.getElementById('workMemo');

          if (confirmBtn) {
            confirmBtn.addEventListener('click', function() {
              const record = App.getTodayRecord();
              if (!record) return;

              const clockOutTime = new Date();
              const clockInTime = new Date(record.clockInTime);
              const workHours = (clockOutTime - clockInTime) / (1000 * 60 * 60);

              record.clockOutTime = clockOutTime.toISOString();
              record.clockOutLat = App.gpsLocation ? App.gpsLocation.lat : null;
              record.clockOutLng = App.gpsLocation ? App.gpsLocation.lng : null;
              record.workHours = Math.round(workHours * 100) / 100;
              record.overtimeHours = Math.max(0, Math.round((workHours - 8) * 100) / 100);
              record.memo = workMemo ? workMemo.value : '';
              record.status = 'completed';

              App.save();
              alert('é€€å‹¤ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼');
              self.render('home');
            });
          }
        }

        // ç®¡ç†è€…ç”»é¢
        if (view === 'admin') {
          document.querySelectorAll('.menu-card').forEach(function(card) {
            card.addEventListener('click', function() {
              const targetView = this.getAttribute('data-view');
              if (targetView) {
                self.render(targetView);
              }
            });
          });
        }

        // æ—¥åˆ¥ä¸€è¦§
        if (view === 'dailyList') {
          const dateSelect = document.getElementById('dateSelect');
          if (dateSelect) {
            dateSelect.addEventListener('change', function() {
              App.selectedDate = this.value;
              self.render('dailyList');
            });
          }
        }

        // å¾“æ¥­å“¡ãƒã‚¹ã‚¿
        if (view === 'employeeMaster') {
          const addBtn = document.getElementById('addEmployeeBtn');
          if (addBtn) {
            addBtn.addEventListener('click', function() {
              const name = document.getElementById('newEmpName').value.trim();
              const role = document.getElementById('newEmpRole').value;
              const rate = parseInt(document.getElementById('newEmpRate').value) || 14000;
              const password = document.getElementById('newEmpPassword').value || '1234';

              if (!name) {
                alert('å¾“æ¥­å“¡åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
              }

              const maxId = Math.max(...App.employees.filter(e => e.id !== 'admin').map(e => parseInt(e.id)));
              const newId = (maxId + 1).toString();

              App.employees.push({
                id: newId,
                name: name,
                role: role,
                dailyRate: rate,
                isActive: true,
                password: password
              });
              App.save();
              self.render('employeeMaster');
            });
          }

          // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤º
          document.querySelectorAll('.show-password-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
              const empId = this.getAttribute('data-emp');
              const emp = App.employees.find(e => e.id === empId);
              const valueEl = document.querySelector('.password-value[data-emp="' + empId + '"]');
              if (valueEl.textContent === 'â€¢â€¢â€¢â€¢') {
                valueEl.textContent = emp.password;
                this.textContent = 'éš ã™';
              } else {
                valueEl.textContent = 'â€¢â€¢â€¢â€¢';
                this.textContent = 'è¡¨ç¤º';
              }
            });
          });

          // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
          document.querySelectorAll('.change-password-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
              const empId = this.getAttribute('data-emp');
              const inputEl = document.querySelector('.password-input[data-emp="' + empId + '"]');
              const newPass = inputEl.value.trim();
              if (!newPass || newPass.length < 4) {
                alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯4æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
              }
              const emp = App.employees.find(e => e.id === empId);
              emp.password = newPass;
              App.save();
              alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
              inputEl.value = '';
            });
          });

          // æœ‰åŠ¹/ç„¡åŠ¹åˆ‡æ›¿
          document.querySelectorAll('.toggle-btn[data-emp]').forEach(function(btn) {
            btn.addEventListener('click', function() {
              const empId = this.getAttribute('data-emp');
              const emp = App.employees.find(e => e.id === empId);
              emp.isActive = !emp.isActive;
              App.save();
              self.render('employeeMaster');
            });
          });
        }

        // ç¾å ´ãƒã‚¹ã‚¿
        if (view === 'siteMaster') {
          const addBtn = document.getElementById('addSiteBtn');
          if (addBtn) {
            addBtn.addEventListener('click', function() {
              const name = document.getElementById('newSiteName').value.trim();
              const address = document.getElementById('newSiteAddress').value.trim();

              if (!name) {
                alert('ç¾å ´åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
              }

              App.jobSites.push({
                id: Date.now().toString(),
                name: name,
                address: address,
                isActive: true
              });
              App.save();
              self.render('siteMaster');
            });
          }

          document.querySelectorAll('.toggle-btn[data-site]').forEach(function(btn) {
            btn.addEventListener('click', function() {
              const siteId = this.getAttribute('data-site');
              const site = App.jobSites.find(s => s.id === siteId);
              site.isActive = !site.isActive;
              App.save();
              self.render('siteMaster');
            });
          });
        }

        // ä¿®æ­£ä¾é ¼ä¸€è¦§
        if (view === 'correctionList') {
          // æ‰¿èªãƒœã‚¿ãƒ³
          document.querySelectorAll('.approve-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
              const correctionId = this.getAttribute('data-correction');
              const correction = App.corrections.find(c => c.id === correctionId);
              if (!correction) return;

              if (!confirm('ã“ã®ä¿®æ­£ä¾é ¼ã‚’æ‰¿èªã—ã€è©²å½“ã®å‹¤æ€ è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;

              // å‹¤æ€ è¨˜éŒ²ã‚’å‰Šé™¤
              App.records = App.records.filter(r => r.id !== correction.recordId);
              
              // ä¿®æ­£ä¾é ¼ã‚’æ‰¿èªæ¸ˆã¿ã«
              correction.status = 'approved';
              correction.processedAt = new Date().toISOString();
              
              App.save();
              alert('æ‰¿èªã—ã¾ã—ãŸã€‚å‹¤æ€ è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
              self.render('correctionList');
            });
          });

          // å´ä¸‹ãƒœã‚¿ãƒ³
          document.querySelectorAll('.reject-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
              const correctionId = this.getAttribute('data-correction');
              const correction = App.corrections.find(c => c.id === correctionId);
              if (!correction) return;

              if (!confirm('ã“ã®ä¿®æ­£ä¾é ¼ã‚’å´ä¸‹ã—ã¾ã™ã‹ï¼Ÿ')) return;

              correction.status = 'rejected';
              correction.processedAt = new Date().toISOString();
              
              App.save();
              alert('å´ä¸‹ã—ã¾ã—ãŸã€‚');
              self.render('correctionList');
            });
          });
        }
      }
    };

    // ã‚¢ãƒ—ãƒªèµ·å‹•
    Views.render('login');
  </script>
</body>
</html>
